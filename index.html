<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="wf-poppins-n9-active wf-poppins-n4-active wf-poppins-n5-active wf-poppins-n7-active wf-poppins-n3-active wf-active">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>A Studio Vero agradece seu cadastro!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Mantendo os estilos originais -->
    <style>
        body { text-align: center; background-color: #b30000; color: white; font-family: Arial, sans-serif; }
        .container { margin-top: 50px; }
        .button {
            display: inline-block;
            padding: 15px 20px;
            background: #25D366;
            color: white;
            font-size: 18px;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .button:hover { background: #1eb154; }
        .footer { margin-top: 30px; font-size: 12px; }
    </style>
</head>

<body>

    <div class="container">
        <h1>A Studio Vero agradece seu cadastro!</h1>
        <p>Se preferir, voc√™ pode entrar em contato conosco agora mesmo pelo WhatsApp! Basta clicar no bot√£o abaixo.</p>

        <!-- BOT√ÉO DO WHATSAPP -->
        <a id="whatsapp-button" class="button" href="#" target="_blank">
            Fale com nossa equipe pelo WhatsApp
        </a>
    </div>

    <div class="footer">Todos os direitos reservados 2024 ¬© Desenvolvido por V4 Fran√ßa & Co</div>

    <!-- C√≥digo JavaScript corrigido -->
    <script>
        // Garantir que o c√≥digo s√≥ rode na p√°gina de obrigado
        if (window.location.pathname.includes("/obrigado")) {

            // Fun√ß√£o para gerar n√∫mero de protocolo aleat√≥rio (4 a 5 d√≠gitos)
            function gerarProtocolo() {
                return Math.floor(10000 + Math.random() * 90000); // N√∫mero entre 10000 e 99999
            }

            // Fun√ß√£o para capturar UTMs da URL
            function getUTMParams() {
                let params = new URLSearchParams(window.location.search);
                return {
                    utm_source: params.get("utm_source") || "desconhecido",
                    utm_medium: params.get("utm_medium") || "desconhecido",
                    utm_campaign: params.get("utm_campaign") || "desconhecido",
                    utm_term: params.get("utm_term") || "",
                    utm_content: params.get("utm_content") || ""
                };
            }

            // Fun√ß√£o principal que ser√° chamada ao carregar a p√°gina
            function atualizarBotaoWhatsApp() {
                var numeroWhatsApp = "5511916792333"; // Seu n√∫mero do WhatsApp
                var protocolo = gerarProtocolo();
                var utms = getUTMParams();

                // Criar mensagem personalizada com protocolo e UTMs
                var mensagem = `Voc√™ ser√° transferido para atendimento. Guarde este n√∫mero de protocolo, pois ser√° necess√°rio inform√°-lo para continuar com seu suporte.\n\nüìå *PROTOCOLO:* ${protocolo}\n\n*Aten√ß√£o:* N√£o apague esta mensagem para garantir um atendimento mais r√°pido!`;

                // Criar o link do WhatsApp com UTMs
                var linkWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}` +
                                   `&utm_source=${utms.utm_source}&utm_medium=${utms.utm_medium}&utm_campaign=${utms.utm_campaign}&utm_term=${utms.utm_term}&utm_content=${utms.utm_content}`;

                // Atualizar o bot√£o de WhatsApp com o link correto
                var botaoWhatsApp = document.getElementById("whatsapp-button");
                if (botaoWhatsApp) {
                    botaoWhatsApp.setAttribute("href", linkWhatsApp);
                    botaoWhatsApp.dataset.whatsappLink = linkWhatsApp; // Armazena o link para evitar reprocessamento

                    console.log("‚úÖ Bot√£o do WhatsApp atualizado:", linkWhatsApp);
                    console.log("üìå Protocolo gerado:", protocolo);
                    console.log("üîó UTMs capturadas:", utms);
                } else {
                    console.error("‚ùå Nenhum bot√£o do WhatsApp foi encontrado!");
                }
            }

            // Esperar a p√°gina carregar antes de modificar o bot√£o
            window.addEventListener("load", function () {
                setTimeout(atualizarBotaoWhatsApp, 500); // Reduzindo tempo de espera para evitar atrasos
            });

            // Impedir que a p√°gina seja duplicada ao clicar no bot√£o
            document.getElementById("whatsapp-button").addEventListener("click", function (event) {
                event.preventDefault(); // Evita comportamento padr√£o
                var link = this.dataset.whatsappLink; // Obt√©m o link atualizado do WhatsApp
                if (link) {
                    window.open(link, "_blank"); // Abre WhatsApp em nova aba
                }
            });
        }
    </script>

</body>
</html>
